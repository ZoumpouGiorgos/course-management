<% mine = (message.user_id == current_user_id) %>

<div class="flex gap-3 <%= mine ? "flex-row-reverse" : "flex-row" %> group">
  <% unless mine %>
    <div class="shrink-0 self-end mb-0.5">
      <%= render "shared/avatar", user: message.user, link: false %>
    </div>
  <% end %>

  <div class="flex flex-col <%= mine ? "items-end" : "items-start" %> min-w-0">
    <% unless mine %>
      <div class="text-xs font-semibold text-gray-700 mb-1.5 px-1">
        <%= message.user.username %>
      </div>
    <% end %>

    <div
    class="
      inline-block w-auto max-w-[70%] min-w-[140px]
      <%= mine ? "bg-purple-600 text-white" : "bg-white text-gray-900" %>
      rounded-2xl <%= mine ? "rounded-br-md" : "rounded-bl-md" %>
      px-4 py-2.5
      <%= mine ? "shadow-md shadow-purple-600/20" : "shadow-sm border border-gray-200" %>
      transition-all group-hover:shadow-lg">
    <div class="text-sm leading-relaxed mt-1 break-words">
      <%= simple_format(h(message.body), {}, wrapper_tag: "span") %>
    </div>
  </div>

    <div class="text-[10px] <%= mine ? "text-purple-600/60" : "text-gray-400" %> mt-1 px-1 font-medium">
      <%= (message.created_at || Time.current).strftime("%H:%M") %>
    </div>
  </div>
</div>